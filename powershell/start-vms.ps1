# Copyright (c) bfren - licensed under https://mit.bfren.dev/2020


$Version = "0.1.2012091256"


# ======================================================================================================================
# Configuration
# ======================================================================================================================

$LogRoot = "C:\Users\Administrator\Documents\Backup Logs"


# ======================================================================================================================
# Set variables
# ======================================================================================================================

$Today = Get-Date -UFormat "%y%m%d"
$LogFile="$LogRoot\$Today.log"


# ======================================================================================================================
# Define Functions
# ======================================================================================================================

function OutputAndLog {
    Param([String]$Text)

    $Time = Get-Date -UFormat "%Y-%m-%d %H:%M"

    "$Time | $Text" | Write-Output
    "$Time | $Text" | Out-File -FilePath $LogFile -Append
}


# ======================================================================================================================
# Start
# ======================================================================================================================

OutputAndLog "Starting all VMs (start script version $Version)"
Write-Host "Logging to $LogFile"


# ======================================================================================================================
# Get all VMs...
#   Where AutomaticStartAction is set to 'Start'
#   Start VM
# ======================================================================================================================

$VMs = Get-VM | Where-Object {$_.AutomaticStartAction -eq "Start"}
foreach ($VM in $VMs)
{
    OutputAndLog "Starting $VM..."
    Start-VM -VM $VM
    
    OutputAndLog "complete."
}

OutputAndLog "done."
